library(tidyverse)

wages <- read_csv(file = "data/wage_data.csv")

#earnings less than 500000
#reorder education
wages_subset <- wages %>% 
  filter(Earnings > 0, Earnings < 500000) %>% 
  mutate(Education = factor(Education, levels = c("HS Graduate",
                                                  "Bachelors",
                                                  "Masters",
                                                  "PhD/MD/JD"))) %>% 
  filter(!is.na(Education)) 


wages %>% 
  ggplot(aes(x = Education, y = Earnings)) +
  geom_boxplot()

model <- wages_subset %>% 
  lm(Earnings ~ Education, data = .)

anova(model)

# If there were no association between education and earnings,
# the probability of observing this F stat or one more extreme
# is essentually zero.

# residual standard error
# calculate the prediction
# calculate the residual
# calculate residual standard error

residualSE <- wages_subset %>% 
  group_by(Education) %>% 
  mutate(group_mean = mean(Earnings),
         residual = Earnings - group_mean) %>% 
  group_by() %>% 
  summarize(residualSE = sqrt(sum(residual^2)/(n()-4))) %>% 
  pull(residualSE)

# calculate tstar
tstar = qt(0.975,16206)

# calculate upper and lower limits
wages_subset %>% 
  group_by(Education) %>% 
  summarise(n = n(),
            group_mean = mean(Earnings),
            lower = group_mean - tstar * residualSE/sqrt(n),
            upper = group_mean + tstar * residualSE/sqrt(n))








